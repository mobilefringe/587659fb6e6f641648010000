<div class="container-fluid">
    <div class="row-fluid" id="special">
		<div class="col-md-9 content_space">  
		    <h1>Jobs</h1>
		    <div id="prop_jobs">
    	        <h2>Mall Jobs</h2>
    	        <div class="bs-docs-example" id="mall_jobs_container">
    	            <script id="mall_jobs_template" type="x-tmpl-mustache/text">
                        <div class="job_container">
                            <h3>{{ store_name }}</h3>
                            <h4><a href="/jobs/{{ slug}}">{{ name }}</a></h4>
                        </div>
                    </script>
                </div>
            </div>
		    <div id="retail_jobs">
    	        <h2>Retailer Jobs</h2>
    	        <div class="bs-docs-example" id="retailer_jobs_container">
    	            <script id="retailer_jobs_template" type="x-tmpl-mustache/text">
                        <div class="job_container">
                            <h3><a href="/stores/{{ store_slug }}">{{ store_name }}</a></h3>
                            <h4><a href="/jobs/{{ slug }}">{{ name }}</a></h4>
                        </div>
                    </script>
                </div>
            </div>
        </div>

    </div>
</div>
<script>
    $(document).ready(function(e){
        // init(e);
        loadMallDataCached(renderPage);
    })

    function renderPage(){
        var jobs = getJobsList().sortBy(function(o){ return o.start_date});
        console.log(jobs);
        var mall_published_jobs = [];
        var retailer_published_promos = [];
        $.each( jobs , function( key, val ){
            if(val.jobable_type == "Property"){
                today = moment();
                webDate = moment(val.show_on_web_date)
                if (today.tz(getPropertyTimeZone()) >= webDate.tz(getPropertyTimeZone())) {
                    mall_published_jobs.push(val);
                }
            } else {
                today = moment();
                webDate = moment(val.show_on_web_date)
                if (today.tz(getPropertyTimeZone()) >= webDate.tz(getPropertyTimeZone())) {
                    retailer_published_jobs.push(val);
                }     
            } 
        });
        if(mall_published_jobs.length > 0){
            renderJobs("#mall_jobs_container","#mall_jobs_template", mall_published_jobs);
        }
        else{
            $("#prop_jobs").hide();
        }
        if(retailer_published_jobs.length > 0){
            renderJobs("#retailer_jobs_container","#retailer_jobs_template", retailer_published_promos);
        }
        else{
            $("#retail_jobs").hide();
        }
        
            
    }
</script>