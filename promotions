<div class="container-fluid">
	<div class="row-fluid" id="special">
		<div class="col-md-9 content_space">  
		    <h1>Promotions</h1>
            <h2>Store Sales &amp; Promotions</h2>
            <div class="media-list">
                <div class="media" id="promo_container">
                    <script id="promo_template" type="x-tmpl-mustache/text">
                        <div class="row">
                            <a href="{{ slug }}">
                                <img alt="Promotion" class="media-image media-object pull-left" src="{{ promo_image_url_abs }}"/>
                                    
                            </a>
                            <div class="media-body">
                                <h3><a href="/stores/sherwood-morning-sun-health-foods">Morning Sun Health Foods</a></h3>
                                <h3><a href="/promotions/ + {{ slug }}">Morning Sun Health Foods - Get your Savings with our Winter Flyer Sale</a></h3>
                                <h4>{{ dates }}</h4>
                    
                                <p>Our Annual Winter Flyer Sale is on now, so come on in and check out our lowest prices of the Season! Visit your closest location to see what we have in store, or browse the flyers below in PDF format.</p>
                            </div>
                        </div>
                    </script>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>
<script>
    $(document).ready(function(e){
        // init(e);
        loadMallDataCached(renderPage);
    })
    // drop-down-row-today
    function renderPage(){
        var promos = getPromotionsList();
        console.log(promos);
        renderPromotions("#promo_container","#promo_template", promos);
    }
    
    function renderPromotions(container, template, collection){
    var item_list = [];
    var item_rendered = [];
    var template_html = $(template).html();
    Mustache.parse(template_html); 
    $.each( collection , function( key, val ) {
        if (val.promotionable_type == "Store") {
            var store_details = getStoreDetailsByID(val.promotionable_id);
            val.store_detail_btn = store_details.slug ;
            val.store_name = store_details.name;
            val.image_url = store_details.store_front_url_abs;
        }
        else{
            val.store_name = "Marlborough Mall";
            // val.image_url = "";
        }
        if(val.promo_image_url_abs.indexOf('missing.png') > 0){
            val.promo_image_url_abs  = "//www.mallmaverick.com/system/sites/logo_images/000/000/040/original/marlborough_logo.jpg?1399497653";
        }
        
        var show_date = moment(val.show_on_web_date);
        var start = moment(val.start_date).tz(getPropertyTimeZone());
        var end = moment(val.end_date).tz(getPropertyTimeZone());
        if (start.format("DMY") == end.format("DMY")){
            val.dates = start.format("MMM D")
        }
        else{
            val.dates = start.format("MMM D") + " - " + end.format("MMM D")
        }
        
        var rendered = Mustache.render(template_html,val);
        item_rendered.push(rendered);
    });
    $(container).html(item_rendered.join(''));
}
</script>